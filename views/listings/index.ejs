<% layout("/layouts/boilerplate") %>

<!-- Flash Messages -->
<%- include("../includes/flash.ejs") %>

<!-- Category Filter Bar -->
<div id="filters" class="d-flex flex-wrap justify-content-center my-3 gap-3">
  <% categories.forEach(c => { %>
    <div class="filter text-center mx-2">
      <a href="/listings?category=<%= c %>" class="text-decoration-none text-dark <%= category === c ? 'active-filter' : '' %>">
        <p><%= c %></p>
      </a>
    </div>
  <% }) %>
</div>

<!-- Listings Grid -->
<div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-4">
  <% if (!allListings || allListings.length === 0) { %>
    <div class="text-center text-muted mt-5">
      <i class="fa-solid fa-circle-exclamation fa-2x mb-2"></i>
      <p>No listings found for this category.</p>
      <a href="/listings" class="btn btn-outline-dark btn-sm">Show All</a>
    </div>
  <% } else { %>
    <% allListings.forEach(listing => { %>
      <div class="col mb-4">
        <a href="/listings/<%= listing._id %>" class="text-decoration-none text-dark">
          <div class="card listing-card shadow-sm border-0">
            <img src="<%= listing.image ? listing.image.url : '/images/placeholder.png' %>" class="card-img-top rounded" style="height: 18rem; object-fit: cover;" />
            <div class="card-body">
              <h6 class="fw-bold"><%= listing.title || 'No Title' %></h6>
              <p class="mb-1">â‚¹ <%= listing.price ? listing.price.toLocaleString("en-IN") : '0' %> /night</p>
              <small class="text-muted"><%= listing.location || 'Unknown' %>, <%= listing.country || 'Unknown' %></small>
              <span class="badge bg-light text-dark mt-2"><%= listing.category || 'None' %></span>
            </div>
          </div>
        </a>
      </div>
    <% }) %>
  <% } %>
</div>
